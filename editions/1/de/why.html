<title>Warum CouchDB?</title>

<meta charset="utf-8">

<link rel="stylesheet" href="../../../style.css">

<link rel="prev" href="preface.html">

<link rel="next" href="consistency.html">

<script src="../../../script.js"></script>

<h2 id="why">Warum CouchDB?</h2>

<p>Apache CouchDB ist eine neue Art von Datenbank System. Dieses Kapitel soll erläutern, warum es einen Bedarf für solche Systeme gibt als auch die Motivation erklären, die hinter der Entwicklung von CouchDB steckt.

<p>Als CouchDB Entwickler haben wir natürlich ein starkes Interesse daran, CouchDB zu benutzen. In diesem Kapitel wollen wir erklären, worin unser Enthusiasmus liegt. Wir werden zeigen, warum das schemafreie Dokumenten Modell von CouchDB besser für Web Anwendungen ist. Warum die eingebaute Query-Engine ein guter Weg ist, die gespeicherten Daten zu lesen und zu verarbeiten und wie das Design von CouchDB Modularisierung und Skalierbarkeit fördert.
 
<h3 id="relax">Entspann Dich</h3>

<p>Falls man CouchDB mit einem Begriff beschreiben sollte, so ist es <em>Entspann Dich</em>. Es ist der Titel dieses Buches, die Byline von CouchDBs offiziellem Logo und wenn man CouchDB startet, steht dort:

<pre>
Apache CouchDB has started. Time to relax.
</pre>

<p>Warum ist Entspannung wichtig? Die Produktivität von Entwicklern hat sich in den letzten fünf Jahren verdoppelt. Für diesen Schub sind hauptsächlich bessere Tools, die gleichzeitig einfacher zu bedienen sind, verantwortlich. Wenn man &quot;Ruby on Rails&quot; als Beispiel nimmt, so sieht man ein unendlich komplexes Framework mit dem der Einstieg jedoch sehr leicht ist. Rails ist eine Erfolgsgeschichte weil das Hauptziel der Entwicklung auf der einfachen Bedienung lag. Das ist einer der Gründe, warum CouchDB entspannend ist. Das Verstehen der Grundkonzepte von CouchDB fühlt sich für jeden natürlich an, der in irgendeiner Form mit dem Web arbeitet. Selbst nicht-technischen Leuten ist es relativ einfach zu vermitteln.

<p>Nicht im Weg zu stehen, wenn kreative Menschen versuchen ein Problem zu lösen ist eine der wichtigsten Eigenschaften - eine, die CouchDB versucht gut erfüllen. Für uns waren die bestehenden Tools zu schwerfällig - sowohl während der Entwicklung als auch während des Betriebs. Deshalb haben wir uns darauf konzentriert, CouchDB so einfach wie möglich zu halten und es spielend leicht bedienen zu können. Die Kapitel <a href="tour.html">3</a> und <a href="api.html">4</a> zeigen das intuitive HTTP basierte REST API.

<p>Ein weiterer Bereich der Entspannung ist der Produktivbetrieb. Im Betrieb mit einer Anwendung, die von echten Benutzern benutzt wird, versucht CouchDB sein möglichstes, um den Administrator in Ruhe zu lassen. Die interne Architektur ist fehlertolerant und Ausnahmen finden in einer kontrollierten Umgebung statt und werden ordentlich bearbeitet. Einzelne Fehler rauschen nicht durch das ganze System nach oben sondern bleiben auf den einen Request beschränkt.

<p>Die Konzepte von CouchDB sind einfach, dennoch mächtig und gut dokumentiert. Das Produktionsteam (falls es ein Team gibt, andernfalls sind das sie) brauchen keine Sorgen vor unvorhersagbarem Verhalten und schwer nachvollziehbaren Fehlern zu haben. Falls etwas schief gehen sollte, kann man einfach herausfinden, wo das Problem liegt - doch diese Fälle sind selten.

<p>CouchDB ist von Anfang an darauf ausgelegt, mit wechselnder Last vernünftig umzugehen. Sollte eine Webseite auf einmal viele Requests bekommen, wird sie CouchDB einfach weiter beantworten ohne einen zu vergessen. Es mag unter Last etwas länger dauern, aber alle bekommen eine Antwort. Sobald der Ansturm vorüber ist, antwortet CouchDB wieder mit gewohnter Geschwindigkeit.

<p>Der dritte Bereich der Entspannung sind die wechselnden Hardware Anforderungen ihrer Anwendung. Das wird üblicherweise mit <em>Skalierung</em> beschrieben. CouchDB setzt dem Programmierer Grenzen. Das mag auf den ersten Blick unflexibel erscheinen, doch manche Funktionen wurden ganz bewusst weggelassen. Sie wurden weggelassen, weil der Programmierer mit diesen Funktionen in der Lage gewesen wäre, Anwendungen zu schreiben, die nicht skalieren. Das Thema Skalierung von CouchDB wird in <a href="index.html#part/iv">Teil IV, “Deploying CouchDB”</a> ausführlich behandelt.

<p>Kurz gesagt: CouchDB erlaubt keine Dinge, die nachher Ärger machen. Das kann bedeuten, dass man alte Gewohnheiten über Bord werfen muß. In <a href="recipes.html">Kapitel 24, Rezepte</a> finden sich eine Liste von üblichen Aufgaben und wie man sie mit CouchDB löst.

<h3 id="different">Ein anderer Weg Daten zu modellieren</h3>

<p>Wir glauben das CouchDB die Art, wie dokumentenbasierte Anwendungen gebaut werden, verändern wird. CouchDB verbindet ein intuitives Modell zum Speichern von Dokumenten kombiniert mit einer mächtigen Query-Engine, die so einfach ist, dass man sich fragt, warum das erst jetzt entwickelt wurde.

<blockquote>

<p>Django mag <em>für</em> das Web gebaut worden sein, doch CouchDB ist <em>auf</em> dem Web gebaut. Ich habe bisher noch keine Software gesehen, welche die Philosophien von HTTP so vollständig umgesetzt hat. CouchDB lässt Django alt aussehen - genauso wie Django ASP hat alt aussehen lassen.

<p class="attribution">&mdash;Jacob Kaplan-Moss, Django Entwickler

</blockquote>

<p>Das Design von CouchDB bedient sich stark bei bestehenden Web Architekturen und den Konzepten von Resourcen, Methoden und Darstellungen. Es kombiniert diese Dinge in mächtiger Weise um Daten zu suchen, abzubilden, zu kombinieren und zu filtern. Hinzu kommen Fehlertoleranz, extreme Skalierbarkeit und inkrementelle Replikation. Damit definiert CouchDB genau den Sweet Spot für dokumentenbasierte Datenbanken.

<h3 id="better">Ein besserer Ansatz für Standard Anwendungen</h3>

<p>Wir schreiben Software, um unser Leben und das Leben anderer zu erleichtern. Dazu verwenden wir meistens einfache Informationen wie Kontakte, Rechnungen oder Quittungen und verarbeiten sie mithilfe von Computer Software. CouchDB ist ein guter Partner für solche Anwendungen, denn es arbeitet mit der natürlichen Idee von in sich abgeschlossenen Dokumenten, die alle notwendigen Informationen enthalten und mit der Zeit fortgeschrieben werden.

<h4 id="containment">In sich abgeschlossene Daten</h4>

<p>Eine Rechnung enthält alle notwendigen Informationen über einen einzelnen Vorgang. Den Verkäufer, den Käufer, das Datum und eine Auflistung der Dinge oder Dienste, die verkauft wurden. Wie in <a href="#figure/1">Abbildung 1, “In sich abgeschlossene Dokumente”</a> zu sehen ist, gibt es keine abstrakten Referenzen auf dem Stück Papier, die zu einem anderen Stück Papier verweisen, zum Beispiel mit dem Namen und der Adresse des Verkäufers. Buchhalter wissen es zu schätzen, alle Informationen auf einen Blick zu haben. Falls sie die Möglichkeit haben, bevorzugen Programmierer das auch. 

<div class="figure" id="figure/1">

<img src="why/01.png">

<p class="caption">Abbildung 1: In sich abgeschlossene Dokumente

</div>

<p>Doch genau mit solchen Referenzen werden Daten in relationalen Datenbanken modelliert. Jede Rechnung wird als Zeile in einer Tabelle gespeichert. Diese Zeile verweist auf andere Zeilen in anderen Tabellen - eine für den Käufer, eine für den Verkäufer, eine für jedes Teil was verkauft wurde und noch mehr Zeilen, die wiederum die verkauften Teile genauer beschreiben. 

<p>Damit soll der Wert von relationalen Modellen nicht geschmälert werden. Sie sind in vielen Anwendungen im Einsatz und haben sich aus verschiedenen Gründen als sehr nützlich erwiesen. Das vorangegange Beispiel sollte zeigen, dass manche Modelle sich nicht so gut für die Daten der realen Welt eignen.

<p>Schauen wir auf eine einfache Adressdatenbank um einen anderen Ansatz zur Modellierung von Daten zu illustrieren. Ein Ansatz, der näher an der Realität ist, wie zum Beispiel ein Stapel Visitenkarten. Genau wie das Beispiel mit der Rechnung enthält eine Visitenkarte alle wichtigen Informationen auf einen Blick. Wir nennen das "in sich abgeschlossene Daten" und es ist ein wichtiges Konzept beim Verständnis von dokumentenbasierten Datenbanken wie CouchDB.

<h4 id="information">Syntax und Semantik</h4>

<p>Die meisten Visitenkarten enthalten ungefähr die gleichen Informationen: den Namen, vielleicht ein Firmenname und Kontaktinformationen. Obwohl die  Daten zwischen den einzelnen Karten differieren kann, ist doch das allgemeine Schema immer gleich und Personen haben keine Schwierigkeiten damit Visitenkarten als solche zu erkennen. So gesehen kann man eine Visitenkarte als ein <em>reales Dokument</em> beschreiben.

<p>Jan's hat vielleicht eine Telefonnummer aber keine FAX Nummer auf seiner Visitenkarte. Dagegen enthält die Karte von J. Chris beide Nummern. Jan muss das Fehlen einer FAX Nummer nicht umständlich und explizit durch "Fax: Nicht vorhanden" kennzeichnen. Durch einfaches weglassen der FAX Nummer gibt er zu verstehen, dass er keins hat.

<p>Reale Dokumente des gleichen Typs, so wie Visitenkarten, neigen dazu in ihrer <em>Semantik</em> - die Art der Information - sehr ähnlich zu sein. Ihre <em>Syntax</em> oder wie die Information tatsächlich aufgebaut ist, kann jedoch zwischen den einzelnen Karten sehr unterschiedlich sein. Als Personen haben damit kein Problem. Für uns sind diese Variationen normal. 

<p>Während ein traditionelles relationales Datenbank System erfordert, dass man die Daten <em>im voraus</em> durch ein Schema strukturiert, erlaubt das Schema-freie Design von CouchDB die Daten erst <em>nach dem Eintrag</em> in die Datenbank zu strukturieren. Genauso wie man das auch mit realen Dokumenten macht. Wie man Anwendungen mit diesem Ansatz zur Speicherung von Daten entwickelt, wird genau erläutert.

<h3 id="blocks">Building Blocks for Larger Systems</h3>

<p>CouchDB is a storage system useful on its own. You can build many applications with the tools CouchDB gives you. But CouchDB is designed with a bigger picture in mind. Its components can be used as building blocks that solve storage problems in slightly different ways for larger and more complex systems.

<p>Whether you need a system that’s crazy fast but isn’t too concerned with reliability (think logging), or one that guarantees storage in two or more physically separated locations for reliability, but you’re willing to take a performance hit, CouchDB lets you build these systems.

<p>There are a multitude of knobs you could turn to make a system work better in one area, but you’ll affect another area when doing so. One example would be the CAP theorem discussed in the next chapter. To give you an idea of other things that affect storage systems, see Figures <a href="#figure/2">2</a> and <a href="#figure/3">3</a>.

<p>By reducing latency for a given system (and that is true not only for storage systems), you affect concurrency and throughput capabilities.

<div class="figure" id="figure/2">

<img src="why/02.png">

<p class="caption">Figure 2. Throughput, latency, or concurrency

</div>

<div class="figure" id="figure/3">

<img src="why/03.png">

<p class="caption">Figure 3. Scaling: read requests, write requests, or data

</div>

<p>When you want to scale out, there are three distinct issues to deal with: scaling read requests, write requests, and data. Orthogonal to all three and to the items shown in Figures <a href="#figure/2">2</a> and <a href="#figure/3">3</a> are many more attributes like reliability or simplicity. You can draw many of these graphs that show how different features or attributes pull into different directions and thus shape the system they describe.

<p>CouchDB is very flexible and gives you enough building blocks to create a system shaped to suit your exact problem. That’s not saying that CouchDB can be bent to solve any problem—CouchDB is no silver bullet—but in the area of data storage, it can get you a long way.

<h4 id="replication">CouchDB Replication</h4>

<p>CouchDB replication is one of these building blocks. Its fundamental function is to synchronize two or more CouchDB databases. This may sound simple, but the simplicity is key to allowing replication to solve a number of problems: reliably synchronize databases between multiple machines for redundant data storage; distribute data to a cluster of CouchDB instances that share a subset of the total number of requests that hit the cluster (load balancing); and distribute data between physically distant locations, such as one office in New York and another in Tokyo.

<p>CouchDB replication uses the same REST API all clients use. HTTP is ubiquitous and well understood. Replication works incrementally; that is, if during replication anything goes wrong, like dropping your network connection, it will pick up where it left off the next time it runs. It also only transfers data that is needed to synchronize databases.

<p>A core assumption CouchDB makes is that things can go wrong, like network connection troubles, and it is designed for graceful error recovery instead of assuming all will be well. The replication system’s incremental design shows that best. The ideas behind “things that can go wrong” are embodied in the <a href="http://en.wikipedia.org/wiki/Fallacies_of_Distributed_Computing">Fallacies of Distributed Computing</a>:

<ol>

<li>The network is reliable.</li>

<li>Latency is zero.</li>

<li>Bandwidth is infinite.</li>

<li>The network is secure.</li>

<li>Topology doesn’t change.</li>

<li>There is one administrator.</li>

<li>Transport cost is zero.</li>

<li>The network is homogeneous.</li>

</ol>

<p>Existing tools often try to hide the fact that there is a network and that any or all of the previous conditions don’t exist for a particular system. This usually results in fatal error scenarios when something finally goes wrong. In contrast, CouchDB doesn’t try to hide the network; it just handles errors gracefully and lets you know when actions on your end are required.

<h3 id="local">Local Data Is King</h3>

<p>CouchDB takes quite a few lessons learned from the Web, but there is one thing that could be improved about the Web: latency. Whenever you have to wait for an application to respond or a website to render, you almost always wait for a network connection that isn’t as fast as you want it at that point. Waiting a few seconds instead of milliseconds greatly affects user experience and thus user satisfaction.

<p>What do you do when you are offline? This happens all the time—your DSL or cable provider has issues, or your iPhone, G1, or Blackberry has no bars, and no connectivity means no way to get to your data.

<p>CouchDB can solve this scenario as well, and this is where scaling is important again. This time it is scaling down. Imagine CouchDB installed on phones and other mobile devices that can synchronize data with centrally hosted CouchDBs when they are on a network. The synchronization is not bound by user interface constraints like subsecond response times. It is easier to tune for high bandwidth and higher latency than for low bandwidth and very low latency. Mobile applications can then use the local CouchDB to fetch data, and since no remote networking is required for that, latency is low by default.

<p>Can you really use CouchDB on a phone? Erlang, CouchDB’s implementation language has been designed to run on embedded devices magnitudes smaller and less powerful than today’s phones.

<h3 id="wrap">Wrapping Up</h3>

<p>The next chapter further explores the distributed nature of CouchDB. We should have given you enough bites to whet your interest. Let’s go!
